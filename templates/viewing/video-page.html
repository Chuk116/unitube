{% extends 'base-app.html' %}
{% load widget_tweaks %}
{% load static %}
{% block content %}
<p><b>{{video.title}}</b></p>
<iframe width="50%" height="100%" src="{{video.embed_link}}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>{{video.user.username}}</p>
<hr>
<p>{{video.description}}</p>
<hr>
<p><b>{{video.commentthread.num_comments}} Comments</b></p>
<form id='comment-form' method='POST'> {% csrf_token %}
    <input type='hidden' id='this_video' value='{{ video.uni_video_id }}'/>
    <input type='hidden' id='this_thread' value='{{ video.commentthread.pk }}'/>
    <input type='hidden' id='class_' value='{{ video.class_choice }}'/>
    <div class='form-group row'>
        {% render_field commentForm.message %}
        <!-- <div style="padding-left: 5px;"> -->
        <button id='chat-send-button' type='submit'><i class="fa fa-paper-plane-o" aria-hidden="true"></i></button>
        <!-- </div> -->
    </div>
</form>
<script>
    console.log('Hello First')
    var formData = $("#comment-form");
    var msgInput = $("#id_message");
    xhttp = new XMLHttpRequest()
    formData.submit(function(event) {
            event.preventDefault(); // Prevents default submission 
            var msgText = msgInput.val();
            if (msgText != '') {
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        
                    }
                };
                console.log('Hello')
                var token =  $('input[name="csrfmiddlewaretoken"]').attr('value')
                console.log(token)
                // $.ajaxSetup({
                //     beforeSend: function(xhr) {
                //         xhr.setRequestHeader('csrfmiddlewaretoken', token);
                //     }
                // });
                xhttp.open("POST", "{% url 'post-comment' %}", true);
                xhttp.setRequestHeader('csrfmiddlewaretoken', token)
                var post_data = {
                    'comment': msgText,
                    'uni_video_id': $('#this_video').val(),
                    'thread_pk': $('#this_thread').val(),
                    'class_': $('#class_').val(),
                }
                xhttp.send("csfrmiddlewaretoken=" + token + "&comment=" + msgText + "&uni_video_id=" + $("#this_video").val() + "&thread_pk=" + $("#this_thread").val() + "&class_=" + $("class_").val());
                // xhttp.send(JSON.stringify(post_data))
            }
        })
</script>
{% endblock %}